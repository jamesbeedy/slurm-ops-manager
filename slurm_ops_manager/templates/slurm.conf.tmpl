# slurm.conf file generated by Juju.
ClusterName={{ clustername }}

# active controller
{% if active_controller_hostname %}
ControlMachine={{ active_controller_hostname }}
ControlAddr={{ active_controller_ingress_address }}
{% elif active_controller_ingress_address %}
ControlMachine={{ active_controller_ingress_address }}
ControlAddr={{ active_controller_ingress_address }}
{% endif %}

# backup controller
{% if backup_controller_hostname %}
BackupController={{ backup_controller_hostname }}
BackupAddr={{ backup_controller_ingress_address }}
{% elif backup_controller_ingress_address %}
BackupController={{ backup_controller_ingress_address }}
BackupAddr={{ backup_controller_ingress_address }}
{% endif %}

AuthType=auth/munge
AuthInfo="socket={{ munge_socket }}"

CryptoType=crypto/munge

MailProg=/usr/bin/mail 

SlurmUser=slurm
SlurmdUser=slurm

SlurmctldPort=6817
SlurmdPort=6818

SlurmctldPidFile=/srv/slurm/slurmctld.pid
SlurmdPidFile=/srv/slurm/slurmd.pid

SlurmctldLogFile=/var/log/slurm/slurmctld.log
SlurmdLogFile=/var/log/slurm/slurmd.log

SlurmdSpoolDir=/var/spool/slurmd
StateSaveLocation=/var/lib/slurmd

PluginDir=/usr/local/lib/slurm

# SLURMDBD CONFIGURED ON {{ slurmdbd_hostname }}
AccountingStorageType=accounting_storage/slurmdbd
JobAcctGatherType=jobacct_gather/linux
AccountingStorageHost={{ slurmdbd_hostname }}
AccountingStoragePort={{ slurmdbd_port }}
AccountingStoragePass={{ munge_socket }}
# "/var/run/munge/munge.socket.2"


# User specified config
{{custom_config}}

# INCLUDE CLUSTER SPECIFIC CONFIGURATION OVERRIDE
#include /etc/slurm/slurm-%c.conf

# GRES type
GresTypes=gpu 

# COMPUTE NODES 
{% for node in nodes %}
{{node.inventory}}
{%- endfor -%}
{% for partition, values in partitions.items() %}
PartitionName={{ partition }} Nodes={{ values.hosts|join(',') }} Default={{ 'YES' if values.default else 'NO' }} State=UP
{% endfor %}
